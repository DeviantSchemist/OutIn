<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project 1</title>
  <link rel="stylesheet" href="./Assets/reset.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="./Assets/style.css">
</head>

<body>

  <header>
    <nav class="teal darken-2 row">
      <div class="col s6 m2"><span class="material-icons">local_dining</span> Favorites</div>
      <div class="col s12 m1 offset-m2">
        <a href="index.html" class="right">Home</a>
      </div>
    </nav>
  </header>
  <div id="main"></div>
  <script>
    let favorites = localStorage.getItem(JSON.parse('favorites'))
    for (i=0; i<favorites.length; i++){
      axios.get(`https://api.spoonacular.com/recipes/complexSearch?query=${favorites[i]}&apiKey=41efd282bd054cc39081439b0618e131`)
        .then(({ data }) => {
            let recId = data.results.id
            axios.get(`https://api.spoonacular.com/recipes/${recId}/information?apiKey=41efd282bd054cc39081439b0618e131&includeNutrition=true`)
              .then(res => {
                let price = Math.round(100 * (res.data.pricePerServing / 100)) / 100, imgSrc = res.data.image, recipe = res.data.instructions, time = res.data.readyInMinutes, glutenFree = res.data.glutenFree ? true : false, glutenFreeDisplay = ''
                if (glutenFree) {
                  glutenFreeDisplay = '✅'
                }
                else {
                  glutenFreeDisplay = 'X'
                }
                document.getElementById('main').innerHTML += `
                 <div class="col s12 m11">
                  <div class="card horizontal">
                    <div class="card-image">
                      <img src="${imgSrc}" class="responsive-img" alt="${res.data.title}">
                  </div>
                  <div class="card-stacked">
                  <div class="card-content">
                  <h4 class="header">${res.data.title}</h4>
                  <p>Gluten-Free: ✅ ${glutenFreeDisplay}</p>
                  <p>Servings: ${res.data.servings}</p>
                  <p>Price: $${price}/serving</p>
                  </div>
                  <div class="card-action">
                  <a href="#recipe${i}" class="modal-trigger">See Recipe</a>
                  <a href=""><span class="material-icons right">bookmark_border</span></a>

                </div>
              </div>
            </div>
          </div>
                    
            <div id="recipe${i}" class="modal modal-fixed-footer">
              <div class="modal-content">
                <h4>${res.data.title}</h4>
                <p>${res.data.instructions}</p>
              </div>
              <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
              </div>
            </div>
            `
              })
              .catch(err => console.error(err))
          })
          .catch (err => console.error(err))
      }
      // document.getElementById('main').innerHTML +=`
      //   <div class="row mt-3">
      //     <div class="col s3">
      //       <img src="${favorites[i].imgSrc}" class="responsive-img" alt="${favorites[i].res.title}">
      //     </div>
      //     <div class="col s9">
      //        <h3 class="mb-1">${favorites[i].res.data.title} </h2>
      //        <p>glutenfree? ${favorites[i].glutenFreeDisplay} </p>
      //        <p class="mb-3">servings: ${favorites[i].res.data.servings} </p>

      //        <p></p>
      //        <p class="mb-3">Price per serving: ${favorites[i].price}$</p>
      //      </div>
      //    </div>
      // `

    
  </script>
</body>